server {
listen 80;

root /usr/share/nginx/html;
index index.html;

# Main location block
location / {
    try_files $uri $uri/ /index.html;

    # 1. CRITICAL: Force the browser to revalidate or re-fetch index.html
    # This prevents the browser from holding onto old HTML that points to old JS bundles.
    if ($uri = '/index.html') {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
}

# 2. OPTIMIZATION: Long-term caching for hashed assets (JS, CSS, images)
# Since your build process creates unique file names (e.g., main.a8d7f.js), 
# we can safely tell the browser to cache them aggressively (1 year).
location ~* \.(js|css|png|jpg|jpeg|gif|ico|woff|woff2|ttf|svg|eot)$ {
    expires 1y;
    access_log off;
    log_not_found off;
    add_header Cache-Control "public, max-age=31536000, immutable";
}


}